<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üéµ Music Search + Play</title>
  <style>
    :root {
      --bg: #121212;
      --card-bg: #181818;
      --card-hover: #282828;
      --text: #ffffff;
      --text-muted: #b3b3b3;
      --brand: #1db954;
      --brand-hover: #1ed760;
      --sidebar: #000000;
      --player-bg: #181818;
      --progress-bar: #535353;
      --progress-active: #b3b3b3;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Circular', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      display: grid;
      grid-template-columns: 240px 1fr;
      grid-template-rows: 1fr auto;
      grid-template-areas:
        "sidebar main"
        "player player";
    }

    /* Sidebar */
    .sidebar {
      grid-area: sidebar;
      background: var(--sidebar);
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .logo {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 16px;
    }

    .nav-item {
      color: var(--text-muted);
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 0;
      transition: color 0.2s ease;
    }

    .nav-item:hover {
      color: var(--text);
    }

    /* Main */
    .main {
      grid-area: main;
      padding: 24px;
      overflow-y: auto;
    }

    .searchbar { margin-bottom: 24px; }

    .search-input {
      width: 100%;
      padding: 12px 16px;
      border-radius: 500px;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      color: var(--text);
      font-size: 14px;
      outline: none;
    }

    .search-input:focus { background: rgba(255, 255, 255, 0.2); }
    .section-title { font-size: 24px; margin: 24px 0 16px; }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 24px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 8px;
      padding: 16px;
      transition: background-color 0.3s ease;
      cursor: pointer;
      position: relative;
    }

    .card:hover { background: var(--card-hover); }

    .card-play {
      position: absolute;
      bottom: 16px;
      right: 16px;
      width: 40px;
      height: 40px;
      background: var(--brand);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: all 0.3s ease;
      transform: translateY(8px);
      box-shadow: 0 8px 8px rgba(0, 0, 0, 0.3);
    }

    .card:hover .card-play {
      opacity: 1;
      transform: translateY(0);
    }

    .card-img {
      width: 100%;
      aspect-ratio: 1;
      object-fit: cover;
      border-radius: 4px;
      margin-bottom: 16px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
    }

    .card-title { font-weight: 700; margin-bottom: 8px; }
    .card-subtitle { font-size: 14px; color: var(--text-muted); }

    /* Player */
    .player {
      grid-area: player;
      background: var(--player-bg);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      padding: 16px;
      display: grid;
      grid-template-columns: 1fr 2fr 1fr;
      align-items: center;
      gap: 16px;
    }

    .player-track { display: flex; align-items: center; gap: 12px; }
    .player-track-img { width: 56px; height: 56px; object-fit: cover; }
    .player-track-title { font-size: 14px; font-weight: 600; }
    .player-track-artist { font-size: 12px; color: var(--text-muted); }

    .player-controls { display: flex; flex-direction: column; align-items: center; gap: 8px; }
    .player-buttons { display: flex; align-items: center; gap: 16px; }

    .player-button {
      background: none; border: none; color: var(--text);
      font-size: 16px; cursor: pointer; width: 32px; height: 32px;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.2s ease;
    }

    .player-button:hover { color: var(--brand); }
    .player-button.active { color: var(--brand); }

    .player-button-play {
      background: var(--text); color: #000; border-radius: 50%;
    }
    .player-button-play:hover { background: var(--brand); color: #000; }

    .player-progress { width: 100%; display: flex; align-items: center; gap: 8px; }
    .player-time { font-size: 11px; color: var(--text-muted); min-width: 40px; }
    .player-bar { flex-grow: 1; height: 4px; background: var(--progress-bar); border-radius: 2px; position: relative; cursor: pointer; }
    .player-progress-bar { position: absolute; left: 0; top: 0; height: 100%; background: var(--progress-active); border-radius: 2px; width: 0%; }
    .player-progress-handle { position: absolute; width: 12px; height: 12px; background: var(--text); border-radius: 50%; top: 50%; transform: translate(-50%, -50%); opacity: 0; }
    .player-bar:hover .player-progress-handle { opacity: 1; }

    .player-actions { display: flex; justify-content: flex-end; align-items: center; gap: 12px; }
    .volume-slider { width: 80px; }

    /* Status */
    .status { color: var(--text-muted); font-size: 14px; margin: 16px 0; }

    /* Responsive */
    @media (max-width: 768px) {
      body { grid-template-columns: 1fr; grid-template-areas: "main" "player"; }
      .sidebar { display: none; }
      .results-grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); }
      .player { grid-template-columns: 1fr; text-align: center; }
      .player-track { justify-content: center; }
      .player-actions { justify-content: center; }
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="logo">Musicify</div>
    <a href="#" class="nav-item">Home</a>
    <a href="#" class="nav-item">Search</a>
    <a href="#" class="nav-item">Your Library</a>
  </div>

  <div class="main">
    <div class="searchbar">
      <input type="text" class="search-input" placeholder="What do you want to listen to?" id="query">
    </div>
    <div id="status" class="status"></div>
    <h2 class="section-title">Search Results</h2>
    <div id="results" class="results-grid"></div>
  </div>

  <div class="player" id="player" style="display:none;">
    <div class="player-track">
      <img class="player-track-img" id="player-img">
      <div>
        <div class="player-track-title" id="player-title">Not Playing</div>
        <div class="player-track-artist" id="player-artist">Search for music</div>
      </div>
    </div>
    <div class="player-controls">
      <div class="player-buttons">
        <button class="player-button" id="prev-btn">‚èÆ</button>
        <button class="player-button" id="shuffle-btn">üîÄ</button>
        <button class="player-button player-button-play" id="play-btn">‚ñ∂Ô∏è</button>
        <button class="player-button" id="next-btn">‚è≠</button>
        <button class="player-button" id="repeat-btn">üîÅ</button>
      </div>
      <div class="player-progress">
        <span id="current-time" class="player-time">0:00</span>
        <div id="progress-bar" class="player-bar">
          <div id="progress" class="player-progress-bar"></div>
          <div id="progress-handle" class="player-progress-handle"></div>
        </div>
        <span id="duration" class="player-time">0:00</span>
      </div>
    </div>
    <div class="player-actions">
      <button class="player-button" id="volume-btn">üîä</button>
      <input type="range" min="0" max="100" value="100" id="volume-slider" class="volume-slider">
    </div>
  </div>

  <iframe id="yt-frame" style="display:none;"></iframe>

  <script>
    const YOUTUBE_API_KEY = "AIzaSyBcGIEyPh4g7TN2gV4CN_KAcO4SpjGJCFA";

    const queryInput = document.getElementById('query');
    const statusBox = document.getElementById('status');
    const resultsEl = document.getElementById('results');
    const playerEl = document.getElementById('player');
    const playerImg = document.getElementById('player-img');
    const playerTitle = document.getElementById('player-title');
    const playerArtist = document.getElementById('player-artist');
    const playBtn = document.getElementById('play-btn');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const shuffleBtn = document.getElementById('shuffle-btn');
    const repeatBtn = document.getElementById('repeat-btn');
    const volumeBtn = document.getElementById('volume-btn');
    const volumeSlider = document.getElementById('volume-slider');
    const currentTimeEl = document.getElementById('current-time');
    const durationEl = document.getElementById('duration');
    const progressBar = document.getElementById('progress-bar');
    const progress = document.getElementById('progress');
    const progressHandle = document.getElementById('progress-handle');

    let player, isPlaying=false, isShuffled=false, isRepeated=false, updateInterval;
    let searchResults=[], currentTrackIndex=-1;

    function initYouTubePlayer() {
      const tag = document.createElement('script');
      tag.src = "https://www.youtube.com/iframe_api";
      document.body.appendChild(tag);
    }
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('yt-frame',{events:{'onReady':()=>{},'onStateChange':onState}});
    }
    function onState(e){
      if(e.data===YT.PlayerState.PLAYING){isPlaying=true;updateBtn();startProgress();}
      if(e.data===YT.PlayerState.PAUSED){isPlaying=false;updateBtn();clearInterval(updateInterval);}
      if(e.data===YT.PlayerState.ENDED){isPlaying=false;updateBtn();clearInterval(updateInterval);
        if(isRepeated){player.seekTo(0);player.playVideo();}else playNext();}}
    
    queryInput.addEventListener('input',()=>{
      clearTimeout(window.searchTimeout);
      const q=queryInput.value.trim();
      if(!q){resultsEl.innerHTML='';statusBox.textContent='';return;}
      statusBox.textContent='Searching...';
      window.searchTimeout=setTimeout(()=>searchMusic(q),500);
    });

    async function searchMusic(q){
      try{
        const url=`https://musicbrainz.org/ws/2/recording?query=${encodeURIComponent(q)}&fmt=json&limit=12&inc=releases+artist-credits`;
        const res=await fetch(url,{headers:{'User-Agent':'music-search-demo'}});
        const data=await res.json();
        searchResults=data.recordings||[];
        if(!searchResults.length){statusBox.textContent='No results.';resultsEl.innerHTML='';return;}
        statusBox.textContent=''; renderResults();
      }catch(e){statusBox.textContent='Network error.';}
    }

    function renderResults(){
      resultsEl.innerHTML='';
      searchResults.forEach((rec,i)=>{
        const card=document.createElement('div');card.className='card';
        const img=document.createElement('img');img.className='card-img';
        const releaseId=rec.releases?.[0]?.id;
        img.src=releaseId?`https://coverartarchive.org/release/${releaseId}/front-250`:"https://via.placeholder.com/250?text=No+Cover";
        const title=document.createElement('div');title.className='card-title';title.textContent=rec.title;
        const subtitle=document.createElement('div');subtitle.className='card-subtitle';
        subtitle.textContent=(rec['artist-credit']?.map(a=>a.name).join(', ')||'Unknown')+" ‚Ä¢ "+(rec['first-release-date']||'Unknown');
        card.append(img,title,subtitle);
        const p=document.createElement('div');p.className='card-play';p.textContent='‚ñ∂Ô∏è';p.onclick=(e)=>{e.stopPropagation();playTrack(i);};
        card.appendChild(p);
        card.onclick=()=>playTrack(i);
        resultsEl.appendChild(card);
      });
    }

    async function playTrack(i){
      if(!searchResults[i])return;
      currentTrackIndex=i;const rec=searchResults[i];
      playerTitle.textContent=rec.title;playerArtist.textContent=rec['artist-credit']?.map(a=>a.name).join(', ')||'Unknown';
      playerImg.src=rec.releases?.[0]?.id?`https://coverartarchive.org/release/${rec.releases[0].id}/front-250`:"https://via.placeholder.com/250?text=No+Cover";
      playerEl.style.display='grid';
      const videoId=await searchYouTube(rec.title+" "+playerArtist.textContent);
      if(videoId&&player){player.loadVideoById(videoId);player.playVideo();}
      else statusBox.textContent="No video found.";
    }

    async function searchYouTube(q){
      const url=new URL("https://www.googleapis.com/youtube/v3/search");
      url.searchParams.set('part','snippet');url.searchParams.set('type','video');url.searchParams.set('maxResults','1');
      url.searchParams.set('q',q);url.searchParams.set('key',YOUTUBE_API_KEY);
      const res=await fetch(url);const data=await res.json();return data.items?.[0]?.id?.videoId||null;
    }

    function togglePlay(){if(player){isPlaying?player.pauseVideo():player.playVideo();}}
    function playNext(){if(!searchResults.length)return;let i=isShuffled?Math.floor(Math.random()*searchResults.length):(currentTrackIndex+1)%searchResults.length;playTrack(i);}
    function playPrev(){if(!searchResults.length)return;let i=isShuffled?Math.floor(Math.random()*searchResults.length):(currentTrackIndex-1+searchResults.length)%searchResults.length;playTrack(i);}
    function toggleShuffle(){isShuffled=!isShuffled;shuffleBtn.classList.toggle('active',isShuffled);}
    function toggleRepeat(){isRepeated=!isRepeated;repeatBtn.classList.toggle('active',isRepeated);}
    function updateBtn(){playBtn.textContent=isPlaying?'‚è∏':'‚ñ∂Ô∏è';}
    function startProgress(){clearInterval(updateInterval);updateInterval=setInterval(()=>{if(!player)return;
      const c=player.getCurrentTime(),d=player.getDuration();progress.style.width=(c/d*100)+"%";progressHandle.style.left=(c/d*100)+"%";
      currentTimeEl.textContent=format(c);durationEl.textContent=format(d);},1000);}
    function format(s){const m=Math.floor(s/60),sec=Math.floor(s%60);return m+":"+(sec<10?"0":"")+sec;}
    progressBar.onclick=(e)=>{if(player){const r=progressBar.getBoundingClientRect();player.seekTo(player.getDuration()*((e.clientX-r.left)/r.width));}};
    volumeSlider.oninput=()=>{if(player)player.setVolume(volumeSlider.value);};
    volumeBtn.onclick=()=>{if(player){if(player.isMuted()){player.unMute();volumeBtn.textContent='üîä';}else{player.mute();volumeBtn.textContent='üîá';}}};

    playBtn.onclick=togglePlay;prevBtn.onclick=playPrev;nextBtn.onclick=playNext;shuffleBtn.onclick=toggleShuffle;repeatBtn.onclick=toggleRepeat;
    initYouTubePlayer();
  </script>
</body>
</html>
