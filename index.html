<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Musicify üéµ</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      color: #333;
    }
    header {
      background: #1db954;
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
    }
    #container {
      display: grid;
      grid-template-columns: 220px 1fr;
      min-height: calc(100vh - 160px);
    }
    nav {
      background: #121212;
      color: white;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    nav button {
      background: none;
      border: none;
      color: white;
      text-align: left;
      font-size: 1rem;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 6px;
      transition: background 0.2s;
    }
    nav button:hover {
      background: rgba(255,255,255,0.1);
    }
    main {
      padding: 1rem;
      overflow-y: auto;
    }
    #searchbar {
      display: flex;
      margin-bottom: 1rem;
    }
    #query {
      flex: 1;
      padding: 0.5rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px 0 0 6px;
      outline: none;
    }
    #searchbtn {
      padding: 0.5rem 1rem;
      border: none;
      background: #1db954;
      color: white;
      border-radius: 0 6px 6px 0;
      cursor: pointer;
      font-size: 1rem;
    }
    #status {
      margin-bottom: 1rem;
      color: #666;
    }
    #results {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 1rem;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 0.5rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      transition: transform 0.2s;
    }
    .card:hover {
      transform: scale(1.03);
    }
    .card-img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 0.5rem;
    }
    .card-title {
      font-weight: bold;
      font-size: 0.95rem;
    }
    .card-subtitle {
      font-size: 0.8rem;
      color: #666;
    }
    .card-actions {
      margin-top: auto;
      display: flex;
      gap: 0.5rem;
    }
    .fav-btn, .playlist-btn {
      flex: 1;
      border: none;
      border-radius: 6px;
      padding: 0.3rem;
      cursor: pointer;
      font-size: 0.8rem;
    }
    .fav-btn {
      background: #eee;
    }
    .fav-btn.active {
      background: #ff4d4d;
      color: white;
    }
    .playlist-btn {
      background: #1db954;
      color: white;
    }
    footer {
      background: #181818;
      color: white;
      display: flex;
      flex-direction: column;
      padding: 1rem;
    }
    #player-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      margin-bottom: 0.5rem;
    }
    #player-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    #player-cover {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 6px;
    }
    #player-controls button {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      margin: 0 0.5rem;
      cursor: pointer;
    }
    #progress-container {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      width: 100%;
    }
    #progress {
      flex: 1;
      -webkit-appearance: none;
      appearance: none;
      height: 6px;
      border-radius: 4px;
      background: #444;
      cursor: pointer;
    }
    #progress::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #1db954;
      cursor: pointer;
    }
    #time-current, #time-total {
      font-size: 0.8rem;
      min-width: 40px;
      text-align: center;
    }
  </style>
</head>
<body>
  <header>üé∂ Musicify</header>
  <div id="container">
    <nav>
      <button onclick="showHome()">üè† Home</button>
      <button onclick="showFavorites()">‚ù§Ô∏è Favorites</button>
      <button onclick="showHistory()">‚è±Ô∏è History</button>
      <button onclick="showPlaylists()">üé∂ Playlists</button>
    </nav>
    <main>
      <div id="searchbar">
        <input id="query" placeholder="Search for a song...">
        <button id="searchbtn" onclick="search(query.value)">Search</button>
      </div>
      <div id="status">Type something to search.</div>
      <h2 id="section-title">Search Results</h2>
      <div id="results"></div>
    </main>
  </div>
  <footer>
    <div id="player-top">
      <div id="player-info">
        <img id="player-cover" src="https://via.placeholder.com/50" alt="">
        <div>
          <div id="player-title">No track</div>
          <div id="player-artist">---</div>
        </div>
      </div>
      <div id="player-controls">
        <button onclick="prevTrack()">‚èÆÔ∏è</button>
        <button id="play-btn" onclick="togglePlay()">‚ñ∂Ô∏è</button>
        <button onclick="nextTrack()">‚è≠Ô∏è</button>
      </div>
    </div>
    <div id="progress-container">
      <span id="time-current">0:00</span>
      <input type="range" id="progress" value="0" min="0" max="100">
      <span id="time-total">0:00</span>
    </div>
    <div id="yt-player"></div>
  </footer>

  <script>
    const YOUTUBE_API_KEY = "AIzaSyBcGIEyPh4g7TN2gV4CN_KAcO4SpjGJCFA"; // replace with your YouTube API key
    const STORAGE_KEY = "musicifyData";
    let musicifyData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
      history: [],
      favorites: [],
      playlists: {}
    };

    let searchResults = [];
    let currentList = [];
    let currentIndex = -1;
    let player;
    let isPlaying = false;
    let progressTimer;

    function saveData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(musicifyData));
    }

    const queryInput = document.getElementById('query');
    const statusBox = document.getElementById('status');
    const resultsEl = document.getElementById('results');
    const sectionTitle = document.getElementById('section-title');
    const progressEl = document.getElementById('progress');
    const timeCurrent = document.getElementById('time-current');
    const timeTotal = document.getElementById('time-total');

    queryInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') search(queryInput.value);
    });

    async function search(q) {
      if (!q) return;
      statusBox.textContent = "Searching...";
      const resp = await fetch(`https://musicbrainz.org/ws/2/recording?query=${encodeURIComponent(q)}&fmt=json&limit=12`);
      const data = await resp.json();
      searchResults = data.recordings || [];
      currentList = searchResults;
      renderResults(searchResults);
      statusBox.textContent = searchResults.length ? `Found ${searchResults.length} tracks` : "No results";
    }

    function renderResults(items) {
      resultsEl.innerHTML = '';
      items.forEach((rec, index) => {
        const card = document.createElement('div');
        card.className = 'card';

        const img = document.createElement('img');
        img.className = 'card-img';
        const releaseId = rec.releases?.[0]?.id;
        img.src = releaseId ? `https://coverartarchive.org/release/${releaseId}/front-250` : placeholder();

        const title = document.createElement('div');
        title.className = 'card-title';
        title.textContent = rec.title || 'Untitled';

        const subtitle = document.createElement('div');
        subtitle.className = 'card-subtitle';
        const artists = rec['artist-credit']?.map(a => a.name).join(', ') || 'Unknown artist';
        subtitle.textContent = artists;

        const actions = document.createElement('div');
        actions.className = 'card-actions';

        const favBtn = document.createElement('button');
        favBtn.className = 'fav-btn';
        favBtn.textContent = '‚ù§Ô∏è';
        if (musicifyData.favorites.find(t => t.id === rec.id)) favBtn.classList.add('active');
        favBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          toggleFavorite(rec);
          favBtn.classList.toggle('active');
        });

        const plBtn = document.createElement('button');
        plBtn.className = 'playlist-btn';
        plBtn.textContent = '‚ûï Playlist';
        plBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          addToPlaylist(rec);
        });

        actions.appendChild(favBtn);
        actions.appendChild(plBtn);

        card.appendChild(img);
        card.appendChild(title);
        card.appendChild(subtitle);
        card.appendChild(actions);
        card.addEventListener('click', () => playTrack(index, items));

        resultsEl.appendChild(card);
      });
    }

    function toggleFavorite(rec) {
      const exists = musicifyData.favorites.find(t => t.id === rec.id);
      if (exists) {
        musicifyData.favorites = musicifyData.favorites.filter(t => t.id !== rec.id);
      } else {
        musicifyData.favorites.push(rec);
      }
      saveData();
    }

    function addToPlaylist(rec) {
      const name = prompt("Enter playlist name:");
      if (!name) return;
      if (!musicifyData.playlists[name]) musicifyData.playlists[name] = [];
      musicifyData.playlists[name].push(rec);
      saveData();
    }

    function showHome() {
      sectionTitle.textContent = "Search Results";
      resultsEl.innerHTML = "<p>Type something in the search bar.</p>";
    }
    function showFavorites() {
      sectionTitle.textContent = "‚ù§Ô∏è Favorites";
      currentList = musicifyData.favorites;
      renderResults(musicifyData.favorites);
    }
    function showHistory() {
      sectionTitle.textContent = "‚è±Ô∏è History";
      currentList = musicifyData.history;
      renderResults(musicifyData.history);
    }
    function showPlaylists() {
      sectionTitle.textContent = "üé∂ Playlists";
      resultsEl.innerHTML = '';
      for (let [name, tracks] of Object.entries(musicifyData.playlists)) {
        const h3 = document.createElement('h3');
        h3.textContent = name;
        h3.className = 'playlist-name';
        resultsEl.appendChild(h3);
        currentList = tracks;
        renderResults(tracks);
      }
    }

    async function playTrack(index, list = searchResults) {
      currentList = list;
      currentIndex = index;
      const rec = list[index];
      if (!rec) return;
      const artists = rec['artist-credit']?.map(a => a.name).join(', ') || 'Unknown';

      document.getElementById('player-title').textContent = rec.title;
      document.getElementById('player-artist').textContent = artists;
      const releaseId = rec.releases?.[0]?.id;
      document.getElementById('player-cover').src = releaseId ? `https://coverartarchive.org/release/${releaseId}/front-250` : placeholder();

      musicifyData.history = musicifyData.history.filter(t => t.id !== rec.id);
      musicifyData.history.unshift(rec);
      if (musicifyData.history.length > 50) musicifyData.history.pop();
      saveData();

      const q = encodeURIComponent(`${rec.title} ${artists}`);
      const resp = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&q=${q}&key=${YOUTUBE_API_KEY}&maxResults=1`);
      const data = await resp.json();
      if (data.items.length) {
        const videoId = data.items[0].id.videoId;
        if (!player) {
          player = new YT.Player('yt-player', {
            height: '0',
            width: '0',
            videoId: videoId,
            playerVars: { 'autoplay': 1 },
            events: {
              'onReady': () => { 
                isPlaying = true; 
                startProgressUpdater();
              },
              'onStateChange': (e) => {
                if (e.data === YT.PlayerState.ENDED) nextTrack();
                if (e.data === YT.PlayerState.PLAYING) startProgressUpdater();
                if (e.data === YT.PlayerState.PAUSED) stopProgressUpdater();
              }
            }
          });
        } else {
          player.loadVideoById(videoId);
          isPlaying = true;
          startProgressUpdater();
        }
        document.getElementById('play-btn').textContent = '‚è∏Ô∏è';
      }
    }

    function togglePlay() {
      if (!player) return;
      if (isPlaying) {
        player.pauseVideo();
        isPlaying = false;
        document.getElementById('play-btn').textContent = '‚ñ∂Ô∏è';
      } else {
        player.playVideo();
        isPlaying = true;
        document.getElementById('play-btn').textContent = '‚è∏Ô∏è';
      }
    }

    function nextTrack() {
      if (currentList.length && currentIndex < currentList.length - 1) {
        playTrack(currentIndex + 1, currentList);
      }
    }

    function prevTrack() {
      if (currentIndex > 0) {
        playTrack(currentIndex - 1, currentList);
      }
    }

    function placeholder() { 
      return "https://via.placeholder.com/250x250?text=No+Cover"; 
    }

    function formatTime(sec) {
      sec = Math.floor(sec);
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      return `${m}:${s.toString().padStart(2,'0')}`;
    }

    function startProgressUpdater() {
      stopProgressUpdater();
      progressTimer = setInterval(() => {
        if (player && player.getDuration) {
          const dur = player.getDuration();
          const cur = player.getCurrentTime();
          if (dur > 0) {
            progressEl.max = dur;
            progressEl.value = cur;
            timeCurrent.textContent = formatTime(cur);
            timeTotal.textContent = formatTime(dur);
          }
        }
      }, 500);
    }

    function stopProgressUpdater() {
      if (progressTimer) clearInterval(progressTimer);
    }

    progressEl.addEventListener('input', () => {
      if (player && player.seekTo) {
        player.seekTo(progressEl.value, true);
      }
    });

    // Load YouTube IFrame API
    let tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.body.appendChild(tag);
  </script>
</body>
</html>
