<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Musicify üéµ</title>
  <style>
:root {
  --bg: #121212;
  --bg-light: #181818;
  --bg-lighter: #282828;
  --text: #fff;
  --text-muted: #b3b3b3;
  --brand: #1db954;
}

body {
  margin: 0;
  font-family: 'Helvetica Neue', Arial, sans-serif;
  background: linear-gradient(180deg, #121212 0%, #181818 100%);
  color: var(--text);
  display: flex;
  height: 100vh;
  overflow: hidden;
}

/* Sidebar */
.sidebar {
  width: 230px;
  background: var(--bg-light);
  display: flex;
  flex-direction: column;
  padding: 20px;
  border-right: 1px solid #282828;
}

.logo {
  font-size: 26px;
  font-weight: 700;
  margin-bottom: 30px;
  color: var(--brand);
}

.nav-item {
  margin: 10px 0;
  color: var(--text-muted);
  cursor: pointer;
  transition: color 0.2s, transform 0.2s;
  text-decoration: none;
  font-size: 15px;
}
.nav-item:hover {
  color: var(--text);
  transform: translateX(5px);
}

/* Main */
.main {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  background: linear-gradient(180deg, #181818, #121212);
}

.searchbar {
  padding: 20px;
  background: rgba(24, 24, 24, 0.9);
  backdrop-filter: blur(8px);
  position: sticky;
  top: 0;
  z-index: 10;
}

.search-input {
  width: 100%;
  padding: 12px 16px;
  border-radius: 25px;
  border: none;
  outline: none;
  font-size: 16px;
  background: var(--bg-lighter);
  color: var(--text);
  transition: box-shadow 0.3s;
}
.search-input:focus {
  box-shadow: 0 0 8px var(--brand);
}

.status {
  padding: 10px 20px;
  font-size: 14px;
  color: var(--text-muted);
}

.section-title {
  font-size: 20px;
  font-weight: bold;
  margin: 20px;
}

/* Cards */
.results-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 20px;
  padding: 0 20px 120px 20px;
}

.card {
  background: var(--bg-light);
  border-radius: 12px;
  padding: 14px;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.3s;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.card:hover {
  transform: translateY(-6px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.5), 0 0 10px rgba(29,185,84,0.4);
}

.card-img {
  width: 100%;
  aspect-ratio: 1/1;
  object-fit: cover;
  border-radius: 8px;
  margin-bottom: 10px;
}

.card-title {
  font-size: 15px;
  font-weight: 600;
  text-align: center;
  margin-bottom: 4px;
}
.card-subtitle {
  font-size: 13px;
  color: var(--text-muted);
  text-align: center;
}

.card-actions {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-top: 8px;
}

.fav-btn, .playlist-btn {
  background: var(--bg-lighter);
  border: none;
  color: var(--text-muted);
  cursor: pointer;
  padding: 5px 10px;
  border-radius: 20px;
  font-size: 13px;
  transition: background 0.2s, color 0.2s;
}
.fav-btn.active {
  color: var(--brand);
}
.fav-btn:hover, .playlist-btn:hover {
  background: var(--brand);
  color: #fff;
}

/* Playlist name */
h3.playlist-name {
  margin: 20px;
  font-size: 18px;
  color: var(--brand);
}

/* Player */
.player {
  position: fixed;
  bottom: 0;
  left: 230px;
  right: 0;
  height: 100px;
  background: rgba(40, 40, 40, 0.95);
  backdrop-filter: blur(10px);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 20px;
  border-top: 1px solid #333;
}

.player-info {
  display: flex;
  align-items: center;
  gap: 12px;
}
.player-info img {
  width: 64px;
  height: 64px;
  border-radius: 6px;
}

.player-controls {
  display: flex;
  align-items: center;
  gap: 15px;
}
.player-controls button {
  background: none;
  border: none;
  color: var(--text);
  font-size: 22px;
  cursor: pointer;
  transition: transform 0.2s, color 0.2s;
}
.player-controls button:hover {
  transform: scale(1.2);
  color: var(--brand);
}

/* Progress bar */
.progress-container {
  position: absolute;
  bottom: 0;
  left: 230px;
  right: 0;
  height: 6px;
  background: #333;
  cursor: pointer;
}
.progress {
  height: 100%;
  width: 0%;
  background: var(--brand);
  transition: width 0.2s linear;
}
/* Mobile Optimizations */
@media (max-width: 768px) {
  body {
    flex-direction: column;
    height: auto;
  }

  /* Sidebar turns into top nav */
  .sidebar {
    width: 100%;
    flex-direction: row;
    justify-content: space-around;
    padding: 10px;
    border-right: none;
    border-bottom: 1px solid #282828;
    position: sticky;
    top: 0;
    z-index: 20;
  }

  .logo {
    display: none; /* hide logo to save space */
  }

  .nav-item {
    font-size: 14px;
    margin: 0;
    flex: 1;
    text-align: center;
  }

  /* Main area takes full width */
  .main {
    flex: none;
    width: 100%;
  }

  /* Search bar compact */
  .searchbar {
    padding: 10px;
  }
  .search-input {
    font-size: 14px;
    padding: 10px;
  }
  #searchbtn {
    margin-top: 8px;
    width: 100%;
  }

  /* Cards: 2 per row */
  .results-grid {
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 12px;
    padding: 10px;
  }

  .card {
    padding: 10px;
  }
  .card-title {
    font-size: 14px;
  }
  .card-subtitle {
    font-size: 12px;
  }

  /* Player adjustments */
  .player {
    left: 0;
    right: 0;
    bottom: 0;
    height: auto;
    flex-direction: column;
    gap: 10px;
    padding: 10px;
  }

  .player-info img {
    width: 48px;
    height: 48px;
  }

  .player-controls {
    gap: 20px;
  }
  .player-controls button {
    font-size: 28px;
  }

  /* Progress bar above controls */
  .progress-container {
    position: relative;
    left: 0;
    right: 0;
    height: 4px;
    margin: 0 10px;
  }
  #time-current, #time-total {
    font-size: 12px;
  }
}

  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="logo">Musicify üéµ</div>
    <a class="nav-item" onclick="showHome()">üè† Home</a>
    <a class="nav-item" onclick="generatePlaylistFromHistory()">üé≤ Generate Mix</a>

    <a class="nav-item" onclick="showFavorites()">‚ù§Ô∏è Favorites</a>
    <a class="nav-item" onclick="showHistory()">‚è±Ô∏è History</a>
    <a class="nav-item" onclick="showPlaylists()">üé∂ Playlists</a>
  </div>

  <!-- Main Content -->
  <div class="main">
    <div class="searchbar">
      <input id="query" class="search-input" placeholder="What do you want to listen to?">
<button id="searchbtn" onclick="search(query.value)">Search</button>   
 </div>

    <div class="status" id="status">Search for your favorite music üéß</div>
    <h2 class="section-title" id="section-title">Search Results</h2>
    <div class="results-grid" id="results"></div>
  </div>

  <!-- Music Player -->
  <div class="player">
    <div class="player-info">
      <img id="player-cover" src="https://via.placeholder.com/64" alt="">
      <div>
        <div id="player-title">No track</div>
        <div id="player-artist">---</div>
      </div>
    </div>
    <div class="player-controls">
      <button onclick="prevTrack()">‚èÆÔ∏è</button>
      <button id="play-btn" onclick="togglePlay()">‚ñ∂Ô∏è</button>
      <button onclick="nextTrack()">‚è≠Ô∏è</button>
    </div>
  </div>
  <div class="progress-container">
<span id="time-current">0:00</span>
      <input type="range" id="progress" value="0" min="0" max="100">
      <span id="time-total">0:00</span>
    </div>
    <div id="yt-player"></div>
    <div class="progress" id="progress"></div>
  </div>


  <script>
    const YOUTUBE_API_KEY = "AIzaSyBcGIEyPh4g7TN2gV4CN_KAcO4SpjGJCFA"; // replace with your YouTube API key
    const STORAGE_KEY = "musicifyData";
    let musicifyData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
      history: [],
      favorites: [],
      playlists: {}
    };

    let searchResults = [];
    let currentList = [];
    let currentIndex = -1;
    let player;
    let isPlaying = false;
    let progressTimer;

    function saveData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(musicifyData));
    }

    const queryInput = document.getElementById('query');
    const statusBox = document.getElementById('status');
    const resultsEl = document.getElementById('results');
    const sectionTitle = document.getElementById('section-title');
    const progressEl = document.getElementById('progress');
    const timeCurrent = document.getElementById('time-current');
    const timeTotal = document.getElementById('time-total');

    queryInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') search(queryInput.value);
    });

    async function search(q) {
      if (!q) return;
      statusBox.textContent = "Searching...";
      const resp = await fetch(`https://musicbrainz.org/ws/2/recording?query=${encodeURIComponent(q)}&fmt=json&limit=12`);
      const data = await resp.json();
      searchResults = data.recordings || [];
      currentList = searchResults;
      renderResults(searchResults);
      statusBox.textContent = searchResults.length ? `Found ${searchResults.length} tracks` : "No results";
    }

    function renderResults(items) {
      resultsEl.innerHTML = '';
      items.forEach((rec, index) => {
        const card = document.createElement('div');
        card.className = 'card';

        const img = document.createElement('img');
        img.className = 'card-img';
        const releaseId = rec.releases?.[0]?.id;
        img.src = releaseId ? `https://coverartarchive.org/release/${releaseId}/front-250` : placeholder();

        const title = document.createElement('div');
        title.className = 'card-title';
        title.textContent = rec.title || 'Untitled';

        const subtitle = document.createElement('div');
        subtitle.className = 'card-subtitle';
        const artists = rec['artist-credit']?.map(a => a.name).join(', ') || 'Unknown artist';
        subtitle.textContent = artists;

        const actions = document.createElement('div');
        actions.className = 'card-actions';

        const favBtn = document.createElement('button');
        favBtn.className = 'fav-btn';
        favBtn.textContent = '‚ù§Ô∏è';
        if (musicifyData.favorites.find(t => t.id === rec.id)) favBtn.classList.add('active');
        favBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          toggleFavorite(rec);
          favBtn.classList.toggle('active');
        });

        const plBtn = document.createElement('button');
        plBtn.className = 'playlist-btn';
        plBtn.textContent = '‚ûï Playlist';
        plBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          addToPlaylist(rec);
        });

        actions.appendChild(favBtn);
        actions.appendChild(plBtn);

        card.appendChild(img);
        card.appendChild(title);
        card.appendChild(subtitle);
        card.appendChild(actions);
        card.addEventListener('click', () => playTrack(index, items));

        resultsEl.appendChild(card);
      });
    }

    function toggleFavorite(rec) {
      const exists = musicifyData.favorites.find(t => t.id === rec.id);
      if (exists) {
        musicifyData.favorites = musicifyData.favorites.filter(t => t.id !== rec.id);
      } else {
        musicifyData.favorites.push(rec);
      }
      saveData();
    }

    function addToPlaylist(rec) {
      const name = prompt("Enter playlist name:");
      if (!name) return;
      if (!musicifyData.playlists[name]) musicifyData.playlists[name] = [];
      musicifyData.playlists[name].push(rec);
      saveData();
    }

    function showHome() {
      sectionTitle.textContent = "Search Results";
      resultsEl.innerHTML = "<p>Type something in the search bar.</p>";
    }
    function showFavorites() {
      sectionTitle.textContent = "‚ù§Ô∏è Favorites";
      currentList = musicifyData.favorites;
      renderResults(musicifyData.favorites);
    }
    function showHistory() {
      sectionTitle.textContent = "‚è±Ô∏è History";
      currentList = musicifyData.history;
      renderResults(musicifyData.history);
    }
    function showPlaylists() {
      sectionTitle.textContent = "üé∂ Playlists";
      resultsEl.innerHTML = '';
      for (let [name, tracks] of Object.entries(musicifyData.playlists)) {
        const h3 = document.createElement('h3');
        h3.textContent = name;
        h3.className = 'playlist-name';
        resultsEl.appendChild(h3);
        currentList = tracks;
        renderResults(tracks);
      }
    }

    async function playTrack(index, list = searchResults) {
      currentList = list;
      currentIndex = index;
      const rec = list[index];
      if (!rec) return;
      const artists = rec['artist-credit']?.map(a => a.name).join(', ') || 'Unknown';

      document.getElementById('player-title').textContent = rec.title;
      document.getElementById('player-artist').textContent = artists;
      const releaseId = rec.releases?.[0]?.id;
      document.getElementById('player-cover').src = releaseId ? `https://coverartarchive.org/release/${releaseId}/front-250` : placeholder();

      musicifyData.history = musicifyData.history.filter(t => t.id !== rec.id);
      musicifyData.history.unshift(rec);
      if (musicifyData.history.length > 50) musicifyData.history.pop();
      saveData();

      const q = encodeURIComponent(`${rec.title} ${artists}`);
      const resp = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&q=${q}&key=${YOUTUBE_API_KEY}&maxResults=1`);
      const data = await resp.json();
      if (data.items.length) {
        const videoId = data.items[0].id.videoId;
        if (!player) {
          player = new YT.Player('yt-player', {
            height: '0',
            width: '0',
            videoId: videoId,
            playerVars: { 'autoplay': 1 },
            events: {
              'onReady': () => { 
                isPlaying = true; 
                startProgressUpdater();
              },
              'onStateChange': (e) => {
                if (e.data === YT.PlayerState.ENDED) nextTrack();
                if (e.data === YT.PlayerState.PLAYING) startProgressUpdater();
                if (e.data === YT.PlayerState.PAUSED) stopProgressUpdater();
              }
            }
          });
        } else {
          player.loadVideoById(videoId);
          isPlaying = true;
          startProgressUpdater();
        }
        document.getElementById('play-btn').textContent = '‚è∏Ô∏è';
      }
    }

    function togglePlay() {
      if (!player) return;
      if (isPlaying) {
        player.pauseVideo();
        isPlaying = false;
        document.getElementById('play-btn').textContent = '‚ñ∂Ô∏è';
      } else {
        player.playVideo();
        isPlaying = true;
        document.getElementById('play-btn').textContent = '‚è∏Ô∏è';
      }
    }

    function nextTrack() {
      if (currentList.length && currentIndex < currentList.length - 1) {
        playTrack(currentIndex + 1, currentList);
      }
    }

    function prevTrack() {
      if (currentIndex > 0) {
        playTrack(currentIndex - 1, currentList);
      }
    }

    function placeholder() { 
      return "https://via.placeholder.com/250x250?text=No+Cover"; 
    }

    function formatTime(sec) {
      sec = Math.floor(sec);
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      return `${m}:${s.toString().padStart(2,'0')}`;
    }

    function startProgressUpdater() {
      stopProgressUpdater();
      progressTimer = setInterval(() => {
        if (player && player.getDuration) {
          const dur = player.getDuration();
          const cur = player.getCurrentTime();
          if (dur > 0) {
            progressEl.max = dur;
            progressEl.value = cur;
            timeCurrent.textContent = formatTime(cur);
            timeTotal.textContent = formatTime(dur);
          }
        }
      }, 500);
    }

    function stopProgressUpdater() {
      if (progressTimer) clearInterval(progressTimer);
    }

    progressEl.addEventListener('input', () => {
      if (player && player.seekTo) {
        player.seekTo(progressEl.value, true);
      }
    });

    // Load YouTube IFrame API
    let tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.body.appendChild(tag);
    let searchTimeout;

// Add this listener instead of relying only on the button
document.getElementById('query').addEventListener('input', (e) => {
  clearTimeout(searchTimeout);
  const q = e.target.value.trim();
  if (!q) {
    document.getElementById('status').textContent = "Search for your favorite music üéß";
    document.getElementById('results').innerHTML = "";
    return;
  }
  // wait 500ms after typing stops
  searchTimeout = setTimeout(() => {
    search(q);
  }, 500);
});
async function generatePlaylistFromHistory() {
  if (!musicifyData.history.length) {
    alert("No history available to generate a playlist.");
    return;
  }

  // Collect unique artists from history
  const artistsSet = new Set();
  musicifyData.history.forEach(track => {
    const credits = track['artist-credit'] || [];
    credits.forEach(c => artistsSet.add(c.name));
  });
  const artists = Array.from(artistsSet);

  if (!artists.length) {
    alert("Couldn‚Äôt find artists in history.");
    return;
  }

  let playlist = [];

  for (let artist of artists) {
    try {
      // Fetch random recordings for each artist
      const resp = await fetch(
        `https://musicbrainz.org/ws/2/recording?query=artist:${encodeURIComponent(artist)}&fmt=json&limit=10`
      );
      const data = await resp.json();
      if (data.recordings && data.recordings.length > 0) {
        // Pick a random track from this artist
        const randomTrack = data.recordings[Math.floor(Math.random() * data.recordings.length)];

        // Attach cover art (if available)
        const releaseId = randomTrack.releases?.[0]?.id;
        randomTrack.cover = releaseId 
          ? `https://coverartarchive.org/release/${releaseId}/front-250`
          : placeholder();

        playlist.push(randomTrack);
      }
    } catch (e) {
      console.error("Error fetching for artist:", artist, e);
    }
  }

  if (!playlist.length) {
    alert("No tracks could be generated.");
    return;
  }

  // Save playlist
  musicifyData.playlists["üé≤ Suggested Mix"] = playlist;
  saveData();

  // Display playlist
  sectionTitle.textContent = "üé≤ Suggested Mix";
  currentList = playlist;
  renderResults(playlist);
}

  </script>
</body>
</html>
