<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>🎵 Music Search + Play</title>
  <style>
    /* === MAIN CSS === */
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #121212;
  color: #fff;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

/* Make app take full height and center search */
#app {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 20px;
}

/* Centered search container */
#search-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
  max-width: 600px;
  margin-bottom: 30px;
}

/* Search input styled like ChatGPT */
#query {
  width: 100%;
  padding: 15px 20px;
  font-size: 18px;
  border: none;
  border-radius: 12px;
  outline: none;
  background: #1e1e1e;
  color: #fff;
  text-align: center;
  box-shadow: 0 2px 10px rgba(0,0,0,0.5);
}

/* Status (Searching... or error text) */
#status {
  margin-top: 10px;
  font-size: 14px;
  color: #aaa;
  text-align: center;
}

/* Results grid (below search bar) */
#results {
  width: 100%;
  max-width: 1000px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 15px;
  justify-content: center;
}

/* Result card */
.card {
  position: relative;
  background: #1e1e1e;
  border-radius: 12px;
  overflow: hidden;
  cursor: pointer;
  transition: transform 0.2s ease;
}
.card:hover {
  transform: scale(1.05);
}
.card-img {
  width: 100%;
  height: 180px;
  object-fit: cover;
}
.card-title {
  font-size: 14px;
  font-weight: bold;
  padding: 8px;
}
.card-subtitle {
  font-size: 12px;
  color: #aaa;
  padding: 0 8px 8px;
}
.card-play {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0,0,0,0.6);
  border-radius: 50%;
  width: 40px;
  height: 40px;
  display: flex;
  justify-content: center;
  align-items: center;
  opacity: 0;
  transition: opacity 0.2s ease;
}
.card:hover .card-play {
  opacity: 1;
}
  </style>
</head>
<body>
   <div class="sidebar">
    <div class="logo">Musicify</div>
    <a href="#" class="nav-item">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14.5c-2.49 0-4.5-2.01-4.5-4.5S9.51 7.5 12 7.5s4.5 2.01 4.5 4.5-2.01 4.5-4.5 4.5z"></path></svg>
      <span>Home</span>
    </a>
    <a href="#" class="nav-item">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"></path></svg>
      <span>Search</span>
    </a>
    <a href="#" class="nav-item">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14.5c-2.49 0-4.5-2.01-4.5-4.5S9.51 7.5 12 7.5s4.5 2.01 4.5 4.5-2.01 4.5-4.5 4.5z"></path></svg>
      <span>Your Library</span>
    </a>
  </div>

  <div class="main">
    <div class="searchbar">
      <input type="text" class="search-input" placeholder="What do you want to listen to?" id="query" autocomplete="off">
    </div>
    
    <div id="status" class="status"></div>
    
    <h2 class="section-title">Search Results</h2>
    <div id="results" class="results-grid"></div>
  </div>

  <div class="player" id="player" style="display: none;">
    <div class="player-track">
      <img class="player-track-img" id="player-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==">
      <div class="player-track-info">
        <div class="player-track-title" id="player-title">Not Playing</div>
        <div class="player-track-artist" id="player-artist">Search for music</div>
      </div>
    </div>
    
    <div class="player-controls">
      <div class="player-buttons">
        <button class="player-button" id="prev-btn">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M13 2.5L5 7.119V3H3v10h2V8.881l8 4.619z"></path></svg>
        </button>
        <button class="player-button" id="shuffle-btn">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M4.5 6.8l.7-.8C4.1 4.7 2.5 4 .9 4v1c1.3 0 2.6.6 3.5 1.6l.1.2zm7.5 4.7c-1.2 0-2.3-.5-3.2-1.3l-.6.8c1 1 2.4 1.5 3.8 1.5V14l3.5-2-3.5-2v1.5zm0-6V7l3.5-2L12 3v1.5c-1.6 0-3.2.7-4.2 2l-3.4 3.9c-.9 1-2.2 1.6-3.5 1.6v1c1.6 0 3.2-.7 4.2-2l3.4-3.9c.9-1 2.2-1.6 3.5-1.6z"></path></svg>
        </button>
        <button class="player-button player-button-play" id="play-btn">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M4.018 14L14.41 8 4.018 2z"></path></svg>
        </button>
        <button class="player-button" id="next-btn">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M12.7 1a.7.7 0 0 0-.7.7v5.15L2.05 1.107A.7.7 0 0 0 1 1.712v12.575a.7.7 0 0 0 1.05.607L12 9.149V14.3a.7.7 0 0 0 .7.7h1.6a.7.7 0 0 0 .7-.7V1.7a.7.7 0 0 0-.7-.7h-1.6z"></path></svg>
        </button>
        <button class="player-button" id="repeat-btn">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M5.5 5H10v1.5l3.5-2-3.5-2V4H5.5C3 4 1 6 1 8.5c0 .6.1 1.2.4 1.8l.9-.5C2.1 9.4 2 9 2 8.5 2 6.6 3.6 5 5.5 5zm9.1 1.7l-.9.5c.2.4.3.8.3 1.3 0 1.9-1.6 3.5-3.5 3.5H6v-1.5l-3.5 2 3.5 2V13h4.5C13 13 15 11 15 8.5c0-.6-.1-1.2-.4-1.8z"></path></svg>
        </button>
      </div>
      <div class="player-progress">
        <span class="player-time" id="current-time">0:00</span>
        <div class="player-bar" id="progress-bar">
          <div class="player-progress-bar" id="progress"></div>
          <div class="player-progress-handle" id="progress-handle"></div>
        </div>
        <span class="player-time" id="duration">0:00</span>
      </div>
    </div>
    
    <div class="player-actions">
      <button class="player-button" id="volume-btn">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M15 8.5c0-1.3-1-2.4-2.2-2.7v1.5c.4.2.7.6.7 1.2 0 .6-.3 1-.7 1.2v1.5c1.2-.3 2.2-1.4 2.2-2.7zm-3.5-4.3v1.5c1.9.6 3.3 2.4 3.3 4.5s-1.4 3.9-3.3 4.5v1.5c2.5-.7 4.3-3 4.3-6s-1.8-5.3-4.3-6zM4.5 8H1c-.6 0-1-.4-1-1s.4-1 1-1h3.5l4-4v14l-4-4z"></path></svg>
      </button>
    </div>
  </div>

  <!-- Hidden YouTube player -->
  <iframe id="yt-frame" title="YouTube player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="display: none;"></iframe>
  <script>
    // Replace with your YouTube API key
    const YOUTUBE_API_KEY = "AIzaSyBcGIEyPh4g7TN2gV4CN_KAcO4SpjGJCFA";
    
    // DOM elements
    const queryInput = document.getElementById('query');
    const statusBox = document.getElementById('status');
    const resultsEl = document.getElementById('results');
    const playerEl = document.getElementById('player');
    const playerImg = document.getElementById('player-img');
    const playerTitle = document.getElementById('player-title');
    const playerArtist = document.getElementById('player-artist');
    const playBtn = document.getElementById('play-btn');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const shuffleBtn = document.getElementById('shuffle-btn');
    const repeatBtn = document.getElementById('repeat-btn');
    const volumeBtn = document.getElementById('volume-btn');
    const currentTimeEl = document.getElementById('current-time');
    const durationEl = document.getElementById('duration');
    const progressBar = document.getElementById('progress-bar');
    const progress = document.getElementById('progress');
    const progressHandle = document.getElementById('progress-handle');
    
    // Player state
    let player;
    let currentTrack = null;
    let isPlaying = false;
    let isShuffled = false;
    let isRepeated = false;
    let updateInterval;
    let searchResults = [];
    let currentTrackIndex = -1;
    
    // Initialize YouTube Player
    function initYouTubePlayer() {
      const tag = document.createElement('script');
      tag.src = "https://www.youtube.com/iframe_api";
      const firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    }
    
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('yt-frame', {
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    }
    
    function onPlayerReady(event) {
      document.querySelectorAll('.player-button').forEach(btn => {
        btn.disabled = false;
      });
    }
    
    function onPlayerStateChange(event) {
      switch(event.data) {
        case YT.PlayerState.PLAYING:
          isPlaying = true;
          updatePlayButton();
          startProgressTimer();
          break;
        case YT.PlayerState.PAUSED:
          isPlaying = false;
          updatePlayButton();
          clearInterval(updateInterval);
          break;
        case YT.PlayerState.ENDED:
          isPlaying = false;
          updatePlayButton();
          clearInterval(updateInterval);
          if (isRepeated) {
            player.seekTo(0);
            player.playVideo();
          } else {
            playNextTrack();
          }
          break;
      }
    }
    
    // Search input
    let searchTimeout;
    queryInput.addEventListener('input', (e) => {
      clearTimeout(searchTimeout);
      const q = e.target.value.trim();
      if (!q) {
        resultsEl.innerHTML = '';
        statusBox.textContent = '';
        return;
      }
      statusBox.textContent = 'Searching...';
      searchTimeout = setTimeout(() => searchMusic(q), 500);
    });
    
    async function searchMusic(q) {
      try {
        const url = `https://musicbrainz.org/ws/2/recording?query=${encodeURIComponent(q)}&fmt=json&limit=12&inc=releases+artist-credits`;
        const res = await fetch(url, { 
          headers: { 'User-Agent': 'music-search-spotify/1.0 (example@example.com)' } 
        });
        const data = await res.json();
        searchResults = Array.isArray(data.recordings) ? data.recordings : [];
        if (searchResults.length === 0) {
          statusBox.textContent = 'No results found. Try a different search.';
          resultsEl.innerHTML = '';
          return;
        }
        statusBox.textContent = '';
        renderResults(searchResults);
      } catch (err) {
        console.error(err);
        statusBox.textContent = 'Failed to search. Check your network.';
      }
    }
    
    function renderResults(items) {
      resultsEl.innerHTML = '';
      items.forEach((rec, index) => {
        const card = document.createElement('div');
        card.className = 'card';
        const img = document.createElement('img');
        img.className = 'card-img';
        const releaseId = rec.releases?.[0]?.id;
        if (releaseId) {
          img.src = `https://coverartarchive.org/release/${releaseId}/front-250`;
          img.onerror = () => { img.src = placeholder(); };
        } else {
          img.src = placeholder();
        }
        const title = document.createElement('div');
        title.className = 'card-title';
        title.textContent = rec.title || 'Untitled';
        const subtitle = document.createElement('div');
        subtitle.className = 'card-subtitle';
        const artists = rec['artist-credit']?.map(a => a.name).join(', ') || 'Unknown artist';
        const releaseDate = rec['first-release-date'] || 'Unknown year';
        subtitle.textContent = `${artists} • ${releaseDate}`;
        const playBtn = document.createElement('div');
        playBtn.className = 'card-play';
        playBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M4.018 14L14.41 8 4.018 2z"></path></svg>';
        playBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          playTrack(index);
        });
        card.appendChild(img);
        card.appendChild(title);
        card.appendChild(subtitle);
        card.appendChild(playBtn);
        card.addEventListener('click', () => playTrack(index));
        resultsEl.appendChild(card);
      });
    }
    
    async function playTrack(index) {
      if (!searchResults[index]) return;
      const rec = searchResults[index];
      const artists = rec['artist-credit']?.map(a => a.name).join(', ') || 'Unknown artist';
      const imgUrl = rec.releases?.[0]?.id 
        ? `https://coverartarchive.org/release/${rec.releases[0].id}/front-250` 
        : placeholder();
      currentTrackIndex = index;
      currentTrack = { title: rec.title || 'Untitled', artist: artists, imgUrl };
      playerTitle.textContent = currentTrack.title;
      playerArtist.textContent = currentTrack.artist;
      playerImg.src = currentTrack.imgUrl;
      playerEl.style.display = 'grid';
      try {
        const q = `${currentTrack.title} ${currentTrack.artist}`.trim();
        const videoId = await searchYouTubeVideo(q);
        if (!videoId) {
          alert('No YouTube video found for this track');
          return;
        }
        if (player && typeof player.loadVideoById === 'function') {
          player.loadVideoById(videoId);
          player.playVideo();
        } else {
          document.getElementById('yt-frame').src = `https://www.youtube.com/embed/${videoId}?autoplay=1&enablejsapi=1`;
        }
      } catch (err) {
        console.error('Error playing track:', err);
        alert('Failed to load video');
      }
    }
    
    async function searchYouTubeVideo(q) {
      const endpoint = new URL('https://www.googleapis.com/youtube/v3/search');
      endpoint.searchParams.set('part', 'snippet');
      endpoint.searchParams.set('type', 'video');
      endpoint.searchParams.set('maxResults', '1');
      endpoint.searchParams.set('q', q);
      endpoint.searchParams.set('key', YOUTUBE_API_KEY);
      const res = await fetch(endpoint.toString());
      const data = await res.json();
      return data.items?.[0]?.id?.videoId || null;
    }
    
    function togglePlay() {
      if (!player) return;
      if (isPlaying) player.pauseVideo();
      else player.playVideo();
    }
    function playNextTrack() {
      if (searchResults.length === 0) return;
      let nextIndex = isShuffled
        ? Math.floor(Math.random() * searchResults.length)
        : (currentTrackIndex + 1) % searchResults.length;
      playTrack(nextIndex);
    }
    function playPrevTrack() {
      if (searchResults.length === 0) return;
      let prevIndex = isShuffled
        ? Math.floor(Math.random() * searchResults.length)
        : (currentTrackIndex - 1 + searchResults.length) % searchResults.length;
      playTrack(prevIndex);
    }
    function toggleShuffle() {
      isShuffled = !isShuffled;
      shuffleBtn.classList.toggle('active', isShuffled);
    }
    function toggleRepeat() {
      isRepeated = !isRepeated;
      repeatBtn.classList.toggle('active', isRepeated);
    }
    function updatePlayButton() {
      if (isPlaying) {
        playBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M3 3h3v10H3zm7 0h3v10h-3z"></path></svg>';
      } else {
        playBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M4.018 14L14.41 8 4.018 2z"></path></svg>';
      }
    }
    function startProgressTimer() {
      clearInterval(updateInterval);
      updateProgress();
      updateInterval = setInterval(updateProgress, 1000);
    }
    function updateProgress() {
      if (!player) return;
      const currentTime = player.getCurrentTime();
      const duration = player.getDuration();
      if (duration && currentTime != null) {
        const progressPercent = (currentTime / duration) * 100;
        progress.style.width = `${progressPercent}%`;
        progressHandle.style.left = `${progressPercent}%`;
        currentTimeEl.textContent = formatTime(currentTime);
        durationEl.textContent = formatTime(duration);
      }
    }
    function seekToPosition(e) {
      if (!player) return;
      const rect = progressBar.getBoundingClientRect();
      const pos = Math.min(Math.max(0, (e.clientX - rect.left) / rect.width), 1);
      player.seekTo(player.getDuration() * pos);
    }
    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
    }
    
    // Event listeners
    playBtn.addEventListener('click', togglePlay);
    prevBtn.addEventListener('click', playPrevTrack);
    nextBtn.addEventListener('click', playNextTrack);
    shuffleBtn.addEventListener('click', toggleShuffle);
    repeatBtn.addEventListener('click', toggleRepeat);
    progressBar.addEventListener('click', seekToPosition);

    // ❌ deleted old progressBar mousemove preview here

    // ✅ NEW draggable progress bar
    let isDragging = false;
    progressHandle.addEventListener('mousedown', (e) => {
      isDragging = true;
      updateSeek(e);
    });
    document.addEventListener('mousemove', (e) => {
      if (isDragging) updateSeek(e);
    });
    document.addEventListener('mouseup', (e) => {
      if (isDragging) {
        isDragging = false;
        seekToPosition(e);
      }
    });
    function updateSeek(e) {
      const rect = progressBar.getBoundingClientRect();
      const pos = Math.min(Math.max(0, (e.clientX - rect.left) / rect.width), 1);
      progress.style.width = `${pos * 100}%`;
      progressHandle.style.left = `${pos * 100}%`;
      const previewTime = player.getDuration() * pos;
      currentTimeEl.textContent = formatTime(previewTime);
    }

    // Disable buttons until player is ready
    document.querySelectorAll('.player-button').forEach(btn => btn.disabled = true);
    function placeholder() {
      return 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==';
    }
    initYouTubePlayer();
  </script>
</body>
</html>
