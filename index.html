
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ðŸŽµ Music Search + Play</title>
  <style>
    :root {
      --bg: #f3f4f6;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --brand: #2563eb;
      --brand-600: #1d4ed8;
      --ring: rgba(37, 99, 235, 0.35);
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, Noto Sans, "Apple Color Emoji", "Segoe UI Emoji"; background: var(--bg); color: var(--text); }
    .container { max-width: 920px; margin: 0 auto; padding: 24px; }
    h1 { font-size: 28px; margin: 0 0 16px; }

    .searchbar { display: grid; grid-template-columns: 1fr auto; gap: 12px; margin-bottom: 20px; }
    .input { padding: 12px 14px; border: 1px solid #e5e7eb; border-radius: 12px; background: #fff; outline: none; font-size: 16px; }
    .input:focus { border-color: var(--brand); box-shadow: 0 0 0 4px var(--ring); }
    .button { padding: 12px 18px; border-radius: 12px; background: var(--brand); color: #fff; border: 0; cursor: pointer; font-weight: 600; }
    .button:hover { background: var(--brand-600); }

    .results { list-style: none; padding: 0; margin: 0; display: grid; gap: 12px; }
    .item { display: grid; grid-template-columns: 80px 1fr; gap: 14px; align-items: center; background: var(--card); border-radius: 16px; padding: 12px; border: 1px solid #e5e7eb; cursor: pointer; }
    .item:hover { background: #fbfbfb; }
    .cover { width: 80px; height: 80px; border-radius: 12px; object-fit: cover; background: #e5e7eb; }
    .title { font-weight: 700; margin: 0 0 4px; }
    .meta { margin: 0; font-size: 14px; color: var(--muted); }

    .player { margin-top: 20px; background: var(--card); border: 1px solid #e5e7eb; border-radius: 16px; padding: 12px; }
    .now { margin: 0 0 10px; font-size: 18px; font-weight: 700; }
    iframe { width: 100%; height: 420px; border: 0; border-radius: 12px; }

    .status { margin: 8px 0 16px; color: var(--muted); font-size: 14px; }
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸŽµ Music Search + Play</h1>
    <form class="searchbar" id="search-form">
      <label class="sr-only" for="query">Search</label>
      <input id="query" class="input" type="text" placeholder="Enter song or artist nameâ€¦" autocomplete="off" />
      <button class="button" type="submit">Search</button>
    </form>
    <div id="status" class="status"></div>
    <ul id="results" class="results"></ul>

    <div id="player" class="player" style="display:none;">
      <p class="now">â–¶ Now Playing</p>
      <iframe id="yt-frame" title="YouTube player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    </div>
  </div>

  <script>
    // ======= SET THIS! =======
    const YOUTUBE_API_KEY = "AIzaSyBcGIEyPh4g7TN2gV4CN_KAcO4SpjGJCFA"; // replace with your key from Google Cloud Console

    const form = document.getElementById('search-form');
    const queryInput = document.getElementById('query');
    const statusBox = document.getElementById('status');
    const resultsEl = document.getElementById('results');
    const playerEl = document.getElementById('player');
    const iframeEl = document.getElementById('yt-frame');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const q = queryInput.value.trim();
      if (!q) return;
      statusBox.textContent = 'Searchingâ€¦';
      resultsEl.innerHTML = '';
      playerEl.style.display = 'none';

      try {
        const url = `https://musicbrainz.org/ws/2/recording?query=${encodeURIComponent(q)}&fmt=json&limit=12&inc=releases`;
        const res = await fetch(url, { headers: { 'User-Agent': 'music-search-demo/1.0 (example@example.com)' } });
        const data = await res.json();
        const recordings = Array.isArray(data.recordings) ? data.recordings : [];
        if (recordings.length === 0) {
          statusBox.textContent = 'No results found.';
          return;
        }
        statusBox.textContent = '';
        renderResults(recordings);
      } catch (err) {
        console.error(err);
        statusBox.textContent = 'Failed to search. Check your network and try again.';
      }
    });

    function renderResults(items) {
      resultsEl.innerHTML = '';
      for (const rec of items) {
        const li = document.createElement('li');
        li.className = 'item';

        const img = document.createElement('img');
        img.className = 'cover';
        const releaseId = rec.releases && rec.releases[0] && rec.releases[0].id;
        if (releaseId) {
          img.src = `https://coverartarchive.org/release/${releaseId}/front-250`;
          img.alt = `${rec.title} cover`;
          img.onerror = () => { img.src = placeholder(); };
        } else {
          img.src = placeholder();
          img.alt = 'No cover available';
        }

        const info = document.createElement('div');
        const title = document.createElement('p');
        title.className = 'title';
        title.textContent = rec.title || 'Untitled';

        const artist = document.createElement('p');
        artist.className = 'meta';
        const names = (rec['artist-credit'] || []).map(a => a && a.name).filter(Boolean).join(', ');
        artist.textContent = `Artist: ${names || 'Unknown'}`;

        const rel = document.createElement('p');
        rel.className = 'meta';
        rel.textContent = `Release: ${rec['first-release-date'] || 'N/A'}`;

        info.appendChild(title);
        info.appendChild(artist);
        info.appendChild(rel);

        li.appendChild(img);
        li.appendChild(info);

        li.addEventListener('click', () => playOnYouTube(rec.title, names));

        resultsEl.appendChild(li);
      }
    }

    function placeholder() {
      // tiny transparent placeholder so layout is stable
      return 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==';
    }

    async function playOnYouTube(title, artist) {
      if (!YOUTUBE_API_KEY || YOUTUBE_API_KEY.includes('YOUR_')) {
        alert('Please set your YouTube Data API key in the source (YOUTUBE_API_KEY).');
        return;
      }
      const q = `${title} ${artist}`.trim();
      const endpoint = new URL('https://www.googleapis.com/youtube/v3/search');
      endpoint.searchParams.set('part', 'snippet');
      endpoint.searchParams.set('type', 'video');
      endpoint.searchParams.set('maxResults', '1');
      endpoint.searchParams.set('q', q);
      endpoint.searchParams.set('key', YOUTUBE_API_KEY);

      try {
        const res = await fetch(endpoint.toString());
        const data = await res.json();
        if (!data.items || !data.items.length) {
          alert('No video found on YouTube for this track.');
          return;
        }
        const id = data.items[0].id && data.items[0].id.videoId;
        if (!id) {
          alert('Unexpected YouTube response.');
          return;
        }
        iframeEl.src = `https://www.youtube.com/embed/${id}`;
        playerEl.style.display = '';
        // Scroll to player for better UX
        playerEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
      } catch (err) {
        console.error('YouTube API error', err);
        alert('Failed to load video. Check your API key/quotas and network.');
      }
    }
  </script>
</body>
</html>
